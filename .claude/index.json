{
  "version": "2.0.0",
  "generated_at": "2026-02-05T23:42:58Z",
  "project": {
    "name": "PRISM-Gateway",
    "description": "统一的 7 维度复盘和 Gateway 系统",
    "path": "/Volumes/Model/Workspace/Agent/prism-gateway-docs",
    "type": "documentation",
    "status": "Phase 2.0 Week 4-5",
    "repository": "https://github.com/prism-gateway/prism-gateway"
  },
  "scan_summary": {
    "total_files": 55,
    "scanned_files": 55,
    "coverage_percentage": 100,
    "total_size": "~480KB",
    "truncated": false,
    "last_scan": "2026-02-05T23:42:58Z"
  },
  "modules": [
    {
      "path": "/Volumes/Model/Workspace/Agent/prism-gateway-docs",
      "name": "root",
      "type": "root",
      "description": "PRISM-Gateway 项目文档根目录",
      "files_count": 5,
      "key_files": [
        "CLAUDE.md",
        "INDEX.md",
        "MEMORY_CLEANUP_REPORT.md",
        ".gitignore",
        ".claude/index.json"
      ],
      "highlights": [
        "根级 AI 上下文文档（48KB）",
        "完整的 Analytics 模块文档",
        "MEMORY 系统清理报告"
      ]
    },
    {
      "path": "/Volumes/Model/Workspace/Agent/prism-gateway-docs/reports",
      "name": "reports",
      "type": "module",
      "description": "项目报告、复盘和风险监控框架",
      "documentation": "reports/CLAUDE.md",
      "files_count": 15,
      "key_files": [
        "PHASE1_MVP_DEEP_RETROSPECTIVE_REPORT.md",
        "PHASE2_ARCHITECTURE.md",
        "WEEK2-3_COMPLETION_REPORT.md",
        "WEEK4-5_RISK_MONITORING_FRAMEWORK.md",
        "WEEK4-5_DAILY_RISK_CHECKLIST.md",
        "WEEK4-5_EMERGENCY_RESPONSE_PLAN.md",
        "WEEK4-5_QUALITY_MONITORING_DASHBOARD.md",
        "ANALYTICS_ARCHITECTURE.md",
        "DAY3_ANALYTICS_INFRASTRUCTURE_COMPLETION_REPORT.md"
      ],
      "subsections": {
        "phase1_reports": 3,
        "phase2_reports": 7,
        "week4_5_risk_framework": 4,
        "verification_reports": 3,
        "delivery_reports": 1
      },
      "highlights": [
        "Week 4-5 风险监控框架（4份文档，72KB）",
        "Phase 2 架构设计（37KB）",
        "Week 2-3 完成报告（357个测试）",
        "Analytics 架构文档"
      ]
    },
    {
      "path": "/Volumes/Model/Workspace/Agent/prism-gateway-docs/docs",
      "name": "docs",
      "type": "module",
      "description": "使用文档、数据迁移指南和技术文档",
      "documentation": "docs/CLAUDE.md",
      "files_count": 8,
      "key_files": [
        "MIGRATION_GUIDE.md",
        "DATA_MIGRATION_PLAN.md",
        "MIGRATION_ROLLBACK_PLAN.md",
        "MIGRATION_VALIDATION_PLAN.md",
        "mcp-server.md",
        "FILE_LOCK_USAGE.md",
        "PROJECT_PROGRESS.md"
      ],
      "subsections": {
        "migration_docs": 5,
        "usage_docs": 3
      },
      "highlights": [
        "Shadow Migration Pattern 设计",
        "MCP Server 集成文档",
        "跨平台文件锁实现",
        "四层验证机制"
      ]
    },
    {
      "path": "/Volumes/Model/Workspace/Agent/prism-gateway-docs/api",
      "name": "api",
      "type": "module",
      "description": "完整 API 文档，包含核心类和接口定义",
      "documentation": "api/CLAUDE.md",
      "files_count": 10,
      "key_files": [
        "README.md",
        "GatewayGuard.md",
        "MemoryStore.md",
        "DataExtractor.md",
        "RetrospectiveCore.md",
        "QuickReview.md",
        "PatternMatcher.md",
        "PrincipleChecker.md",
        "TrapDetector.md"
      ],
      "subsections": {
        "core_apis": 6,
        "pattern_matchers": 3,
        "sidebar": 1
      },
      "highlights": [
        "三层 Gateway 检查机制",
        "三层 MEMORY 架构 API",
        "7 维度数据提取接口",
        "完整的类型定义"
      ]
    },
    {
      "path": "/Volumes/Model/Workspace/Agent/prism-gateway-docs/scripts",
      "name": "scripts",
      "type": "utilities",
      "description": "重构执行脚本，遵循 Shadow Migration Pattern",
      "documentation": "scripts/README.md",
      "files_count": 8,
      "key_files": [
        "00-prepare.sh",
        "01-integrate-configs.sh",
        "02-move-reports.sh",
        "03-organize-data.sh",
        "04-integrate-docs.sh",
        "05-update-imports.sh",
        "06-verify.sh",
        "07-cleanup.sh",
        "rollback.sh",
        "README.md"
      ],
      "subsections": {
        "refactor_scripts": 9
      },
      "highlights": [
        "零停机迁移脚本",
        "完整回滚支持",
        "分阶段验证机制",
        "一键执行脚本"
      ]
    },
    {
      "path": "/Volumes/Model/Workspace/Agent/prism-gateway-docs/prism-gateway",
      "name": "prism-gateway",
      "type": "code",
      "description": "PRISM-Gateway 主项目代码",
      "documentation": "prism-gateway/README.md",
      "status": "Phase 2.0",
      "entry_points": [
        "src/index.ts",
        "src/cli/index.ts",
        "src/api/server.ts"
      ],
      "files": {
        "typescript": 120,
        "tests": 412,
        "documentation": 10
      },
      "dependencies": {
        "runtime": [
          "@modelcontextprotocol/sdk",
          "commander",
          "hono",
          "typescript"
        ],
        "dev": [
          "bun-types",
          "typedoc",
          "typedoc-plugin-markdown"
        ]
      },
      "submodules": [
        {
          "name": "src/core/analytics",
          "type": "analytics",
          "status": "完成",
          "tests": 82,
          "coverage": ">90%",
          "documentation": "prism-gateway/src/core/analytics/README.md",
          "key_components": [
            "UsageAggregator",
            "QualityAggregator",
            "PerformanceAggregator",
            "TrendAggregator",
            "TrendAnalyzer",
            "AnomalyDetector",
            "CacheManager",
            "AnalyticsService"
          ],
          "highlights": [
            "82 个单元测试（100% 通过）",
            "LRU 缓存 + TTL",
            "统计学异常检测",
            "线性回归趋势分析"
          ]
        },
        {
          "name": "src/integration/mcp",
          "type": "integration",
          "status": "完成",
          "tests": 49,
          "key_files": [
            "MCPServer.ts"
          ],
          "highlights": [
            "49 个测试通过",
            "响应时间 <20ms",
            "6 个 MCP 工具"
          ]
        },
        {
          "name": "src/infrastructure/lock",
          "type": "infrastructure",
          "status": "完成",
          "tests": 45,
          "key_files": [
            "FileLock.ts",
            "LockMonitor.ts"
          ],
          "highlights": [
            "跨平台支持（macOS/Linux/Windows）",
            "进程崩溃安全",
            "acquire <50ms"
          ]
        },
        {
          "name": "src/migration",
          "type": "migration",
          "status": "完成",
          "tests": 43,
          "key_files": [
            "MigrationRunner.ts",
            "phase1-to-phase2.ts"
          ],
          "highlights": [
            "Shadow Migration Pattern",
            "四层验证机制",
            "性能超标 29999 倍"
          ]
        }
      ],
      "highlights": [
        "Analytics 模块完成（82 测试）",
        "MCP Server 集成",
        "文件锁机制",
        "数据迁移系统"
      ]
    }
  ],
  "key_concepts": {
    "prism_framework": {
      "description": "7 维度复盘框架",
      "dimensions": [
        "Principles (原则)",
        "Patterns (模式)",
        "Benchmarks (基准)",
        "Traps (陷阱)",
        "Success (成功)",
        "Tools (工具)",
        "Data (数据)"
      ]
    },
    "memory_architecture": {
      "description": "三层 MEMORY 架构",
      "layers": [
        "Level-1 Hot: 实时查询 (<100ms)",
        "Level-2 Warm: 复盘历史 (可读写)",
        "Level-3 Cold: 知识库 (只读)"
      ]
    },
    "gateway_checking": {
      "description": "三层检查架构",
      "layers": [
        "Layer 1: Principle checking (MANDATORY)",
        "Layer 2: Pattern matching (WARNING)",
        "Layer 3: Trap detection (ADVISORY)"
      ]
    },
    "analytics_module": {
      "description": "Analytics 数据分析引擎",
      "capabilities": [
        "指标聚合（Usage, Quality, Performance, Trend）",
        "趋势分析（线性回归、移动平均、变化点检测）",
        "异常检测（Z-score、多维度检测）",
        "缓存管理（LRU + TTL）",
        "统一接口（AnalyticsService）"
      ],
      "stats": {
        "tests": 82,
        "coverage": ">90%",
        "pass_rate": "100%"
      }
    },
    "shadow_migration": {
      "description": "Shadow Migration Pattern",
      "features": [
        "Phase 1 数据永不修改",
        "备份在变更前创建",
        "Phase 2 与 Phase 1 共存",
        "回滚随时可用"
      ]
    },
    "risk_monitoring": {
      "description": "Week 4-5 持续风险监控框架",
      "components": [
        "每日风险检查清单（Pentester/Architect/QATester/Engineer）",
        "应急响应预案（P0/P1/P2/P3 级别）",
        "质量指标监控看板",
        "STRIDE 威胁建模"
      ]
    }
  },
  "tech_stack": {
    "runtime": "Bun >=1.0",
    "language": "TypeScript 5.3+",
    "mcp_sdk": "@modelcontextprotocol/sdk-server",
    "http_server": "Hono",
    "testing": "Bun Test",
    "logging": "pino",
    "cli": "Commander 14.x",
    "documentation": "TypeDoc"
  },
  "project_phases": [
    {
      "phase": "Phase 1 MVP",
      "status": "completed",
      "completion_date": "2026-02-03",
      "key_metrics": {
        "development_time": "6 hours",
        "test_coverage": "85%",
        "test_count": 203,
        "performance_improvement": "10-30000x",
        "score": "9.5/10"
      }
    },
    {
      "phase": "Phase 2.0 准备周",
      "status": "completed",
      "completion_date": "2026-02-03"
    },
    {
      "phase": "Phase 2 Week 2-3",
      "status": "completed",
      "completion_date": "2026-02-03",
      "key_metrics": {
        "test_count": 357,
        "test_pass_rate": "100%",
        "mcp_server_tests": 49,
        "filelock_tests": 45,
        "migration_tests": 43,
        "integration_tests": 220
      }
    },
    {
      "phase": "Phase 2 Week 4-5",
      "status": "in_progress",
      "focus": "Analytics + API",
      "key_metrics": {
        "analytics_tests": 82,
        "analytics_coverage": ">90%",
        "risk_framework_docs": 4
      },
      "risk_framework_ready": true
    },
    {
      "phase": "Phase 2 Week 6-7",
      "status": "pending",
      "focus": "Web UI + WebSocket"
    },
    {
      "phase": "Phase 2 Week 8-9",
      "status": "pending",
      "focus": "Scheduler + Backup"
    },
    {
      "phase": "Phase 2 Week 10-11",
      "status": "pending",
      "focus": "Production Ready"
    }
  ],
  "important_paths": {
    "project_root": "~/.prism-gateway/",
    "documentation": "/Volumes/Model/Workspace/Agent/prism-gateway-docs/",
    "knowledge_base": "~/.claude/MEMORY/LEARNING/Gateway/",
    "phase1_data": {
      "hot": "~/.prism-gateway/level-1-hot/",
      "warm": "~/.prism-gateway/level-2-warm/",
      "cold": "~/.prism-gateway/level-3-cold/"
    },
    "phase2_data": {
      "analytics": "~/.prism-gateway/analytics/",
      "cache": "~/.prism-gateway/cache/",
      "config": "~/.prism-gateway/config/",
      "logs": "~/.prism-gateway/logs/"
    }
  },
  "performance_benchmarks": {
    "gateway_check": {
      "target": "<1000ms",
      "actual": "<100ms",
      "achievement": "1000%"
    },
    "quick_retrospective": {
      "target": "<5min",
      "actual": "<5min",
      "achievement": "100%"
    },
    "memory_read_write": {
      "target": "<100ms",
      "actual": "<100ms",
      "achievement": "100%"
    },
    "mcp_response": {
      "target": "<100ms",
      "actual": "<20ms",
      "achievement": "500%"
    },
    "filelock_acquire": {
      "target": "<100ms",
      "actual": "<50ms",
      "achievement": "200%"
    },
    "migration_1000_records": {
      "target": "<5min",
      "actual": "<0.01s",
      "achievement": "29999%"
    },
    "analytics_cache_hit_rate": {
      "target": ">80%",
      "actual": ">80%",
      "achievement": "100%"
    }
  },
  "test_statistics": {
    "total_tests": 412,
    "unit_tests": 82,
    "integration_tests": 330,
    "pass_rate": "100%",
    "coverage": ">85%",
    "by_module": {
      "analytics": 82,
      "mcp_server": 49,
      "filelock": 45,
      "migration": 43,
      "integration": 220
    }
  },
  "ignore_patterns": [
    ".DS_Store",
    "*.log",
    "node_modules/**",
    "dist/**",
    ".cache/**",
    ".vscode/**",
    ".idea/**",
    "*.swp",
    "*.swo",
    "*~",
    ".git/**",
    "*.pdf",
    "*.png",
    "*.jpg",
    "*.jpeg",
    "*.gif",
    "*.mp4",
    "*.zip",
    "*.tar",
    "*.gz"
  ],
  "gaps": [
    {
      "module": "prism-gateway/analytics",
      "issue": "Bun 模块解析限制",
      "impact": "集成测试无法直接导入 AnalyticsService",
      "workaround": "使用内联实现替代",
      "priority": "中",
      "status": "已记录"
    },
    {
      "module": "prism-gateway/analytics",
      "issue": "LRU 缓存测试不稳定",
      "impact": "单个测试场景未在 CI 中验证",
      "workaround": "标记为 todo",
      "priority": "低",
      "status": "已记录"
    }
  ],
  "next_steps": [
    "完成 Week 4-5 Analytics + API 开发",
    "验证 Analytics 模块集成测试路径",
    "修复 LRU 缓存测试的时间精度问题",
    "开始 Week 6-7 Web UI 开发",
    "实施持续风险监控框架",
    "补充 WebSocket 接口文档（如需要）"
  ],
  "recent_updates": [
    {
      "date": "2026-02-05",
      "changes": [
        "Analytics 模块完成（82 测试，>90% 覆盖率）",
        "更新 .claude/index.json（v2.0.0）",
        "补充测试统计和性能基准",
        "记录 Analytics 模块已知问题"
      ]
    },
    {
      "date": "2026-02-04",
      "changes": [
        "新增 Week 4-5 风险监控框架（4份文档）",
        "新增 scripts/ 重构脚本系统（8个脚本）",
        "新增 MEMORY_CLEANUP_REPORT.md",
        "更新根级 CLAUDE.md 文档"
      ]
    }
  ],
  "metadata": {
    "scan_strategy": "full_inventory",
    "scan_intensity": "module_priority",
    "tools_used": [
      "Read",
      "Glob",
      "Grep"
    ],
    "documented_modules": 5,
    "total_documented_files": 55,
    "documentation_coverage": "100%",
    "last_full_scan": "2026-02-05T23:42:58Z"
  }
}
